/*
 * This file is part of the orkan/wp-base package.
 * Copyright (c) 2024 Orkan <orkans+wpbase@gmail.com>
 */
window.ork=window.ork||{};(function($){ork.Base={getId(name){return'#'+ork.name2id[name]},getElement(name){return document.getElementById(ork.name2id[name])},log(msg,type='log'){if('debug'===type&&!ork.debug){return}else{type='log'}
console[type](msg)},debug(msg){this.log(msg,'debug')},clearForm(form){form.reset();Array.from(form.elements).forEach(input=>{if(input.disabled){return}
switch(input.type.toLowerCase()){case 'text':case 'password':case 'textarea':case 'hidden':input.value='';break;case 'radio':case 'checkbox':input.checked=!1;break;case 'select-one':case 'select-multi':input.selectedIndex=-1;break}})},buildHttpQuery(obj){const Query=new URLSearchParams();for(const[name,value]of Object.entries(obj)){Query.append(name,value)}
return Query.toString()},showSpinner(id,show=!0){$(id+'_spin').toggleClass('is-active',show)},async usleep(usec){return await new Promise((resolve,reject)=>setTimeout(()=>resolve(1),usec))},};ork.Ajax={async fetch(action,data={},opts={}){data.action=action;data[ork.nonce.name]=ork.nonce.action;opts={...{method:'POST',signal:null,spinner:'',body:this.getFormData(data),},...opts};let json,status;this.spinner(opts.spinner,!0);const Response=await fetch(ork.url,opts).then(Response=>{status=`[${Response.status}] ${Response.statusText}`;ork.Base.debug(Response);return Response.text()}).catch(E=>{throw new Error(E)});this.spinner(opts.spinner,!1);try{json=JSON.parse(Response)}catch(E){throw new Error(E)}
if(!json||!json.success){throw new Error(json.data||status)}
return json.data},getFormData(obj){const Data=new FormData();for(const[name,value]of Object.entries(obj)){Data.append(name,value)}
return Data},spinner(id,show=!0,className='is-active'){if(id){const ClassList=document.querySelector(id).classList;show?ClassList.add(className):ClassList.remove(className)}},};$(()=>{let Controller;$(ork.Base.getId('selector_select')).on('change',async(Event)=>{const name=Event.currentTarget.value;const Result=ork.Base.getElement('selector_result');Result.value='---';if(name){try{Controller&&Controller.abort();Controller=new AbortController();Result.value=ork.l10n.wait;Result.value=await ork.Ajax.fetch(ork.ajaxer.action.selector,{name},{signal:Controller.signal,spinner:'#selector_spin',});Controller=null}catch(E){Result.value='Error: '+E.message}}}).change()});$(()=>{let Controller;$(ork.Base.getId('texter_text')).on('input',async(Event)=>{const text=Event.currentTarget.value;const error=ork.Base.getElement('texter_error').checked;const Result=ork.Base.getElement('texter_result');try{Controller&&Controller.abort();Controller=new AbortController();Result.value=await ork.Ajax.fetch(ork.ajaxer.action.echotext,{text,error},{signal:Controller.signal,spinner:'#texter_spin',});Controller=null}catch(E){Result.value='Error: '+E.message}})})})(jQuery)